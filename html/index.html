<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Custom SDL3 WASM App</title>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>

<input id="notes" type="text" placeholder="e.g. 60, 62, 64">
<button onclick="handleNotesInput()">update</button>

<input id="link" type="text" placeholder="url to song json">
<button onclick="loadSong()">update</button>


  <script>

var songTime = 0;

function handleNotesInput() {
  const input = document.getElementById('notes').value;
  const nums = input.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));

  const nBytes = nums.length * 4;
  const ptr = Module._malloc(nBytes);

  Module.HEAPF32.set(nums, ptr >> 2);
  Module.ccall('updateNotes', null, ['number', 'number'], [ptr, nums.length]);
  Module._free(ptr);
}


function loadSong() {
  link = document.getElementById('link').value;
  fetch(link)
    .then(res => res.json())
    .then(obj => {
      const str = JSON.stringify(obj);
      const len = lengthBytesUTF8(str) + 1;
      const ptr = Module._malloc(len);
      stringToUTF8(str, ptr, len);
      Module.ccall('recieveJSON', null, ['number'], [ptr]);
      Module._free(ptr);
    });
}


    var Module = {
      canvas: document.getElementById('canvas'),
      onRuntimeInitialized() {
        console.log('WASM app ready');
          timePtr = Module.ccall('getTimePtr', 'number', [], []);
          timeHeap = new Float32Array(Module.HEAPF32.buffer, timePtr, 1);
      }
    };




  var timePtr;
  var timeHeap;

  function updateTime() {
  timeHeap[0] = songTime;
}
  </script>

    <script src="app.js"></script>

    <script></script>
</body>
</html>
